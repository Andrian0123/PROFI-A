# Измерение треугольником и правило 3–4–5

В строительстве для контроля прямого угла и точных размеров используют **треугольник** с соотношением сторон **3 : 4 : 5**: если два катета 3 м и 4 м, диагональ (гипотенуза) 5 м — угол между катетами 90° (3² + 4² = 9 + 16 = 25 = 5²).

По таким параметрам можно вычислять точные размеры помещения; разбиение на треугольники позволяет считать и **мелкие детали** (откосы, короба, участки стен).

---

## 1. Правило 3–4–5

- **Параметры:** высота (катет) 3 м, ширина (катет) 4 м, диагональ 5 м.
- **Смысл:** проверка прямого угла. Если измеренная диагональ совпадает с 5 м при катетах 3 и 4 — угол 90°.
- **В общем виде:** для катетов *a*, *b* и гипотенузы *c* должно выполняться *a² + b² = c²*.

В PROFI-A:

- В ответе скана в **`dimensions`** добавлено поле **`diagonal_m`** — диагональ пола (м), вычисленная как √(length² + width²). По нему можно проверить прямоугольность и масштаб.
- Модуль **`app/core/processing/triangles.py`**:
  - **`is_right_triangle_345(a, b, c)`** — проверка, что треугольник прямоугольный (допуск ~2%).
  - **`scale_to_345(a, b, c)`** — если треугольник близок к 3–4–5, возвращает масштабированные стороны 3 : 4 : 5.
  - **`refine_length_width_by_diagonal(length_m, width_m, diagonal_m)`** — уточнение длины и ширины по **измеренной** диагонали (если пользователь ввёл диагональ отдельно — подбирается масштаб так, чтобы L² + W² = diag² при сохранении отношения L/W).

---

## 2. Измерение «треугольник в треугольник» и мелкие детали

- Комнату (план пола) можно разбить на **треугольники** по углам и рёбрам. Для каждого треугольника известны три стороны — по ним однозначно восстанавливаются углы и площадь (формула Герона, теорема косинусов).
- **Мелкие детали** (участок стены, откос, короб) тоже можно представить как треугольники: три точки — три стороны, дальше углы и размеры считаются по формулам.

В модуле **`triangles.py`**:

- **`triangle_sides_from_corners_2d(points)`** — по трём точкам (углам) возвращает длины сторон (a, b, c).
- **`triangle_area_heron(a, b, c)`** — площадь треугольника по трём сторонам (Герон).
- **`triangulate_corners_floor_plan(corners_xz)`** — разбиение контура пола (список углов в XZ) на треугольники (веер из первой вершины); список треугольников можно использовать для пошагового вычисления площадей и проверки размеров.
- **`room_rect_from_diagonals_and_sides(side_a_m, side_b_m, diagonal_m)`** — по двум смежным сторонам и диагонали возвращает уточнённые длину и ширину прямоугольника комнаты.

---

## 3. Как использовать в сценариях

| Задача | Что использовать |
|--------|-------------------|
| Проверить прямой угол по 3–4–5 | `is_right_triangle_345(a, b, c)` |
| Масштабировать к 3 : 4 : 5 | `scale_to_345(a, b, c)` |
| Уточнить длину/ширину по измеренной диагонали | `refine_length_width_by_diagonal(L, W, diag)` |
| Стороны треугольника по трём углам (план) | `triangle_sides_from_corners_2d(points)` |
| Площадь по трём сторонам | `triangle_area_heron(a, b, c)` |
| Разбить план пола на треугольники | `triangulate_corners_floor_plan(corners_xz)` |
| Длина и ширина комнаты по двум сторонам и диагонали | `room_rect_from_diagonals_and_sides(side_a, side_b, diag)` |

Диагональ в ответе API (**`dimensions.diagonal_m`**) даёт возможность на клиенте или при постобработке проверять размеры по правилу 3–4–5 и при вводе пользователем своей диагонали — уточнять длину и ширину через `refine_length_width_by_diagonal`.

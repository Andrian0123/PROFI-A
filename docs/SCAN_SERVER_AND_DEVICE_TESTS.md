# Scan: серверная обработка и тесты на устройстве

## Сервер (reference и production)

- **Reference server** (`server/server.js`): эндпоинты `/api/v1/scan/process` (multipart) и `/api/v1/scan/finish` (JSON) возвращают заглушку с полями `scan_id`, `dimensions`, `coverage`, `quality_metrics` по контракту.
- **Production:** реализация должна:
  - Принимать multipart (project_id, room_id, scan_id, frames, опционально trajectory/depth).
  - Запускать пайплайн обработки (SLAM/реконструкция или вызов внешнего сервиса).
  - Возвращать JSON с реальными `dimensions.wall_height_m`, `perimeter_m`, `floor_area_m2`, `coverage.percentage`, `quality_metrics.scan_quality`.
  - Сохранять результат по `scan_id` для последующего вызова `finish` и синхронизации с приложением.

## Тесты на реальном устройстве

Рекомендуемые сценарии (см. также `E2E_TEST_CASES.md`, раздел 3):

1. **Устройство с камерой:** запуск сканирования комнаты, отправка кадров на сервер (или локальный fallback), проверка получения предварительных размеров (высота стен, периметр, площадь).
2. **Сеть:** при включённом `SCAN_SERVER_URL` — успешный ответ; при отключённом сервере/офлайне — fallback без падения.
3. **Регрессия:** после изменений в `RoomScanScreen` или `ScanProcessingApi` прогонять сценарий на реальном устройстве перед релизом.

Автоматизация: инструментальные тесты (Compose UI) могут открывать экран сканирования и проверять видимость элементов; полный E2E с реальной камерой и сервером целесообразно оставить ручным или в отдельном test suite с реальным устройством.

# Как подключить сервер сканирования

Если при сканировании вы видите сообщение **«Сервер сканирования недоступен, показаны локальные оценки»** и значения 12,40 м / 2,75 м — приложение не может достучаться до бэкенда. Ниже — как включить реальную обработку скана.

---

## 1. Запустить Python-сервер на компьютере

В корне проекта (рядом с `app/`, `server/`):

```bash
# Установить зависимости (если ещё не установлены)
pip install -r requirements.txt

# Запустить сервер (по умолчанию порт 8000)
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

Сервер должен вывести что-то вроде: `Uvicorn running on http://0.0.0.0:8000`.

---

## 2. Указать адрес сервера в приложении

Адрес задаётся через **SCAN_SERVER_URL** в сборке.

### Эмулятор Android (на этом же ПК)

Эмулятор обращается к ПК по адресу **10.0.2.2** (не `localhost`).

В `app/build.gradle.kts` в `defaultConfig` замените пустой URL на:

```kotlin
buildConfigField("String", "SCAN_SERVER_URL", "\"http://10.0.2.2:8000\"")
```

Либо вынесите в `local.properties` и читайте в `build.gradle.kts`, чтобы не коммитить свой URL:

```properties
# local.properties
scan.server.url=http://10.0.2.2:8000
```

В `build.gradle.kts`:

```kotlin
val scanServerUrl = project.findProperty("scan.server.url") as? String ?: "\"\""
buildConfigField("String", "SCAN_SERVER_URL", scanServerUrl)
```

И передавайте при сборке: `-Pscan.server.url=http://10.0.2.2:8000` или задайте в `local.properties` как выше.

### Реальное устройство (телефон/планшет)

Узнайте IP компьютера в локальной сети (например, `192.168.1.100`). Убедитесь, что телефон и ПК в одной сети.

В сборке укажите:

```kotlin
buildConfigField("String", "SCAN_SERVER_URL", "\"http://192.168.1.100:8000\"")
```

(подставьте свой IP и порт).

---

## 3. Пересобрать приложение

После изменения `build.gradle.kts` или `local.properties`:

- **Build → Rebuild Project** в Android Studio  
или из терминала: `./gradlew assembleDebug`

Запустите приложение снова и повторите сканирование. Если сервер запущен и URL верный, тост «Сервер сканирования недоступен» не появится, а размеры придут с бэкенда (высота, периметр, площадь по потолку, при наличии — откосы и короба).

---

## Кратко

| Где запущено приложение | SCAN_SERVER_URL        |
|--------------------------|-------------------------|
| Эмулятор                 | `http://10.0.2.2:8000` |
| Устройство в той же сети | `http://<IP ПК>:8000`  |

Сервер должен быть запущен **до** нажатия «Сканировать» / перехода к анализу.

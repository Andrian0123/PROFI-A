# Оптимизация хранения и ресурсов PROFI-A

Дата: 21.02.2026

Цель: уменьшить использование диска (клиент и сервер), не хранить лишние данные.

---

## 1. Репозиторий (.gitignore)

Добавлено в `.gitignore`:

- **Сборки:** `*.apk`, `*.aab`, папка `для_загрузки/` — не коммитить артефакты.
- **Сервер:** `server/node_modules/`, `server/uploads/`, `server/static/`, `server/data/`, `server/logs/` — зависимости и будущие хранилища не попадают в репо.
- **Временные:** `*.log`, `*.tmp`, `.cache/`.

Так уменьшается размер репозитория и не загружаются лишние файлы на GitHub/сервер.

---

## 2. Клиент (Android)

### Удаление временных файлов после использования

- **Сканер документов:** после вызова API `scanDocument()` временный файл в `cacheDir/document_scan/` удаляется (в `DocumentScanViewModel`), чтобы кэш не рос.

### Фоновая очистка кэша при старте приложения

В `ProfiAApplication.onCreate()` запускается фоновая очистка (раз в 2 суток по возрасту файлов):

- **document_scan/** — старые копии выбранных документов.
- **scan_frames/** — старые кадры скана помещения.
- **Корень cacheDir:** файлы с префиксами `estimate_`, `akt_`, `KS-2_`, `KS-3_` (экспорт PDF/CSV) старше 2 суток.

Это снижает занятое место на устройстве без участия пользователя.

### Рекомендации на будущее

- **room_3d (3D-модели комнат):** при реализации удаления комнаты/проекта удалять соответствующие файлы в `filesDir/room_3d/` (шаблон имён: `{projectId}_{roomId}_*.obj`). Сейчас `RoomDao.deleteRoom()` в коде не вызывается.
- При необходимости можно добавить вызов очистки кэша по `onTrimMemory(LEVEL_*_CACHE)` или лимит на суммарный размер папок `document_scan` и `scan_frames`.

---

## 3. Сервер (Node.js)

Текущий эталонный бэкенд **не пишет файлы на диск**: данные только в памяти (users, resetTokens, supportTickets), multipart-запросы обрабатываются в RAM и не сохраняются.

Когда появится реальное сохранение (uploads, логи):

- Папки `server/uploads/`, `server/logs/`, `server/data/` уже добавлены в `.gitignore`.
- Рекомендуется: лимит размера и типов файлов, ротация логов, cron или очистка при старте для удаления файлов в `uploads/` старше N дней (пример кода см. в отчёте агента по оптимизации).

---

## 4. Итог

| Место            | Что сделано |
|------------------|-------------|
| Репозиторий      | Расширен `.gitignore`: APK, node_modules, uploads/logs, *.log, *.tmp. |
| Клиент           | Удаление временного файла после скана документа; очистка кэша (document_scan, scan_frames, экспорт) при старте приложения (старше 2 суток). |
| Сервер           | Подготовлен .gitignore под будущие папки; при появлении записи на диск — ввести лимиты и очистку. |

Лишняя информация и файлы оптимизированы в рамках текущей архитектуры; при добавлении нового хранения стоит сразу закладывать политику очистки и лимиты.

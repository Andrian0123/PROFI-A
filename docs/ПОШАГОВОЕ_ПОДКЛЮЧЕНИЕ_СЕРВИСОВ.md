# Пошаговое подключение сервисов для тестирования ПРОФЙ-А

Подключаем сервисы по порядку: сначала локально, затем (по желанию) в облаке. Все URL задаются в `app/build.gradle.kts`.

---

## Самый простой путь: загрузить проект на GitHub (6 шагов)

Если раньше с Git не работали — делайте **строго по порядку**.

### Шаг А. Создать пустой репозиторий на GitHub

1. Откройте в браузере [github.com](https://github.com) и войдите в аккаунт.
2. Нажмите зелёную кнопку **«New»** (или «+» вверху справа → **New repository**).
3. **Repository name:** напишите, например, `PROFI-A`.
4. **НЕ** ставьте галочку «Add a README file».
5. Нажмите **«Create repository»**.
6. На открывшейся странице скопируйте адрес репозитория — он выглядит так:  
   `https://github.com/ВАШ_ЛОГИН/PROFI-A.git`  
   (подставьте свой логин). Сохраните его — понадобится в шаге Е.

### Шаг Б. Открыть терминал в папке проекта

1. Откройте **Cursor** и откройте папку проекта **E:\PROFI-A** (File → Open Folder).
2. В Cursor откройте встроенный терминал: меню **Terminal → New Terminal** (или сочетание клавиш для терминала).
3. В терминале внизу экрана должна быть строка ввода. Если там путь не к проекту — введите и нажмите Enter:
   ```
   cd E:\PROFI-A
   ```
4. Проверьте: введите `dir` и Enter — должны увидеть папки `app`, `server`, `docs`.

### Шаг В. Инициализировать Git и добавить файлы

В том же терминале вводите по одной строке, после каждой нажимайте **Enter**:

```
git init
```

Потом:

```
git add .
```

Потом (одной строкой, в кавычках можно менять текст):

```
git commit -m "Первый коммит: ПРОФЙ-А и backend"
```

Если после `git commit` появится сообщение про имя и email — один раз выполните (подставьте свои данные):

```
git config --global user.email "ваш@email.com"
git config --global user.name "Ваше Имя"
```

и снова выполните команду `git commit` из предыдущего абзаца.

### Шаг Г. Привязать GitHub и отправить код

Замените `ВАШ_ЛОГИН` и `PROFI-A` на свой логин и имя репозитория с GitHub (из шага А):

```
git remote add origin https://github.com/ВАШ_ЛОГИН/PROFI-A.git
```

Пример: если ваш логин на GitHub — **andrian0123**, то:

```
git remote add origin https://github.com/andrian0123/PROFI-A.git
```

Затем:

```
git branch -M main
```

Затем:

```
git push -u origin main
```

### Шаг Д. Если при Push просят войти

- Может открыться окно входа в GitHub — войдите логином и паролем.
- Если GitHub просит не пароль, а **токен**: зайдите на github.com → Settings → Developer settings → Personal access tokens → Generate new token, поставьте галочку **repo**, скопируйте токен и вставьте его вместо пароля при запросе.

### Шаг Е. Проверка

Откройте в браузере страницу вашего репозитория:  
`https://github.com/ВАШ_ЛОГИН/PROFI-A`  

В списке файлов должны быть папки **app**, **server**, **docs** и другие файлы проекта. В папке **server** должны быть файлы **server-single.js** и **multipart.js**.

Готово. Дальше в Railway можно нажать «Deploy from GitHub» и выбрать этот репозиторий.

---

## Шаг 0. Что нужно заранее

- **Node.js** установлен (проверка: в терминале `node -v` — должна быть версия 18 или выше).
- Проект ПРОФЙ-А открыт в Android Studio / Cursor.
- Для облака: аккаунт на [Render](https://render.com) или [Railway](https://railway.app) (регистрация бесплатная).

---

## Шаг 0.1. Репозиторий на GitHub (если проекта там ещё нет)

Чтобы развернуть backend в Railway или Render, нужен код на GitHub. Если репозитория ПРОФЙ-А там ещё нет — сделайте так.

### 1. Установите Git (если ещё не установлен)

- **Windows:** скачайте [git-scm.com](https://git-scm.com) и установите. В терминале выполните: `git --version`.
- **macOS:** часто уже есть; иначе в терминале: `xcode-select --install` или установите Git с сайта.

### 2. Создайте репозиторий на GitHub

1. Зайдите на [github.com](https://github.com) и войдите в аккаунт.
2. Справа вверху нажмите **«+» → «New repository»**.
3. Заполните:
   - **Repository name:** например `PROFI-A` или `profia-app`.
   - **Description:** по желанию (например, «Приложение ПРОФЙ-А»).
   - **Public**.
   - **НЕ** ставьте галочку «Add a README file» (репозиторий создаём пустым, код добавим со своего компьютера).
4. Нажмите **«Create repository»**. Откроется страница с подсказками; там будет URL вида `https://github.com/ВАШ_ЛОГИН/ИМЯ_РЕПОЗИТОРИЯ.git` — он понадобится ниже.

### 3. Инициализируйте Git в папке проекта и загрузите код

Откройте **терминал** (PowerShell или cmd в Windows) и перейдите в **корень проекта** ПРОФЙ-А (папка, где лежат `app/`, `server/`, `docs/` и т.д.):

```bash
cd E:\PROFI-A
```

Далее по шагам:

**3.1. Проверьте, есть ли уже Git в проекте:**

```bash
git status
```

- Если видите «not a git repository» — переходите к п. 3.2.
- Если команда выполняется без ошибки — Git уже инициализирован, переходите к п. 3.3.

**3.2. Инициализация (только если в 3.1 было «not a git repository»):**

```bash
git init
```

**3.3. Добавьте все файлы в коммит:**

```bash
git add .
```

(Точка в конце — «все файлы». Папки `build`, `.gradle`, `.idea` и т.п. не попадут в репозиторий — они перечислены в `.gitignore`.)

**3.4. Сделайте первый коммит:**

```bash
git commit -m "Первый коммит: приложение ПРОФЙ-А и backend server"
```

**3.5. Привяжите удалённый репозиторий GitHub:**

Подставьте вместо `ВАШ_ЛОГИН` и `ИМЯ_РЕПОЗИТОРИЯ` свои данные с GitHub (из шага 2):

```bash
git remote add origin https://github.com/ВАШ_ЛОГИН/ИМЯ_РЕПОЗИТОРИЯ.git
```

Пример: если логин `andrian0123`, репозиторий `PROFI-A`, то:

```bash
git remote add origin https://github.com/andrian0123/PROFI-A.git
```

**3.6. Отправьте код на GitHub:**

```bash
git branch -M main
git push -u origin main
```

Если попросит авторизацию — войдите в GitHub (логин и пароль или токен; в Windows может открыться окно входа).

### 4. Проверка

Откройте в браузере страницу репозитория на GitHub. В корне должны быть папки `app/`, `server/`, `docs/` и файлы проекта. В `server/` должны быть файлы `server.js`, `server-single.js`, `multipart.js`.

После этого в Railway или Render можно выбрать **«Deploy from GitHub repo»** и указать этот репозиторий.

---

## Шаг 1. Локальный backend (Auth + Support + Scan)

Цель: запустить тестовый сервер на своём компьютере.

1. Откройте терминал в папке проекта.
2. Перейдите в папку `server`:
   ```bash
   cd server
   ```
3. Запустите сервер:
   ```bash
   node server.js
   ```
4. В консоли должны появиться строки:
   ```
   [Auth]    http://localhost:3001  (emulator: http://10.0.2.2:3001)
   [Support] http://localhost:3002  (emulator: http://10.0.2.2:3002)
   [Scan]    http://localhost:3003  (emulator: http://10.0.2.2:3003)
   ```
5. Сервер не закрывайте — оставьте окно терминала открытым на время тестов.

**Проверка:** в браузере откройте http://localhost:3002/support/tickets — должен вернуться JSON `{"tickets":[]}` (или с данными, если уже отправляли заявки).

---

## Шаг 2. Настройка приложения для эмулятора Android

Цель: приложение в эмуляторе должно ходить на ваш локальный сервер.

1. В проекте откройте файл **`app/build.gradle.kts`**.
2. Найдите блок `defaultConfig {` и внутри него строки с `buildConfigField`.
3. Замените (или добавьте) так:
   ```kotlin
   buildConfigField("String", "AUTH_SERVER_URL", "\"http://10.0.2.2:3001\"")
   buildConfigField("String", "SUPPORT_SERVER_URL", "\"http://10.0.2.2:3002\"")
   buildConfigField("String", "SCAN_SERVER_URL", "\"http://10.0.2.2:3003\"")
   buildConfigField("String", "VERIFICATION_SERVER_URL", "\"\"")
   ```
   Важно: **без** завершающего слэша в URL. Если какие-то строки уже есть — измените только значения в кавычках.
4. Сохраните файл и выполните **Build → Rebuild Project** (или синхронизацию Gradle).
5. Запустите приложение в **эмуляторе** (не на реальном телефоне).

**Проверка:** в приложении на экране входа введите любой логин и пароль, нажмите «Регистрация» — должна пройти успешно (сервер сохранит пользователя в памяти). Затем отправьте обращение в «Тех. поддержку» — должно появиться сообщение об успешной отправке на сервер.

---

## Шаг 3. Настройка для реального телефона (та же Wi‑Fi)

Цель: тестировать с телефона, когда backend запущен на ПК.

1. Узнайте IP-адрес компьютера в локальной сети:
   - **Windows:** `ipconfig` в cmd — смотрите «IPv4-адрес» (например, 192.168.1.100).
   - **macOS/Linux:** `ifconfig` или `ip addr` — адрес вида 192.168.x.x.
2. В `app/build.gradle.kts` укажите этот IP вместо `10.0.2.2`:
   ```kotlin
   buildConfigField("String", "AUTH_SERVER_URL", "\"http://192.168.1.100:3001\"")
   buildConfigField("String", "SUPPORT_SERVER_URL", "\"http://192.168.1.100:3002\"")
   buildConfigField("String", "SCAN_SERVER_URL", "\"http://192.168.1.100:3003\"")
   buildConfigField("String", "VERIFICATION_SERVER_URL", "\"\"")
   ```
   Подставьте свой IP вместо 192.168.1.100.
3. Пересоберите приложение и установите на телефон. Убедитесь, что телефон в той же Wi‑Fi сети, что и ПК.
4. Сервер `node server.js` должен быть запущен на ПК.

---

## Шаг 4. (Опционально) Деплой в облако Render — один URL для всего

Цель: получить постоянный HTTPS-URL для Auth, Support и Scan, чтобы тестировать без ПК и из любой сети.

### 4.1 Регистрация и репозиторий

1. Зарегистрируйтесь на [render.com](https://render.com) (через GitHub удобнее).
2. Если проект ещё не в Git:
   - Выполните в корне проекта: `git init`, добавьте файлы, сделайте первый коммит.
3. Создайте репозиторий на GitHub и загрузите туда проект (включая папку `server/`).

### 4.2 Создание Web Service на Render

1. В Render: **Dashboard → New + → Web Service**.
2. Подключите репозиторий GitHub и выберите репозиторий проекта ПРОФЙ-А.
3. Настройки:
   - **Name:** например `profia-backend`.
   - **Region:** выберите ближайший.
   - **Branch:** `main` (или ваша основная ветка).
   - **Root Directory:** оставьте пустым (корень репозитория).
   - **Runtime:** **Node**.
   - **Build Command:** оставьте пустым или `echo "No build"`.
   - **Start Command:** укажите:
     ```bash
     node server/server-single.js
     ```
     Важно: путь `server/server-single.js` относительно корня репозитория.
   - **Instance Type:** **Free**.
4. Нажмите **Create Web Service**. Render соберёт и запустит сервис. Дождитесь статуса **Live**.

### 4.3 Получить URL

1. Вверху страницы сервиса будет **URL**, например: `https://profia-backend.onrender.com`.
2. Скопируйте его **без** завершающего слэша.

### 4.4 Прописать URL в приложении

В `app/build.gradle.kts` в `defaultConfig` (или в отдельном `buildTypes` для теста) укажите **один и тот же** URL для Auth, Support и Scan:

```kotlin
buildConfigField("String", "AUTH_SERVER_URL", "\"https://profia-backend.onrender.com\"")
buildConfigField("String", "SUPPORT_SERVER_URL", "\"https://profia-backend.onrender.com\"")
buildConfigField("String", "SCAN_SERVER_URL", "\"https://profia-backend.onrender.com\"")
buildConfigField("String", "VERIFICATION_SERVER_URL", "\"\"")
```

Пересоберите приложение и установите на устройство или эмулятор. Теперь запросы пойдут в облако.

**Важно:** на бесплатном тарифе Render сервис «засыпает» после ~15 минут неактивности. Первый запрос после паузы может занять 30–60 секунд (холодный старт).

---

## Шаг 5. Верификация покупок (VERIFICATION_SERVER_URL)

На этапе тестирования **оставьте пустым**:

```kotlin
buildConfigField("String", "VERIFICATION_SERVER_URL", "\"\"")
```

В этом режиме подписка активируется по ответу Google Play на устройстве, без серверной проверки. Когда будете готовы к продакшену — поднимите endpoint `POST /verify` (по контракту в документации) и укажите его URL здесь.

---

## Шаг 6. Чеклист проверки

| Действие | Где проверить |
|----------|----------------|
| Логин/регистрация | Экран входа → ввести логин и пароль → «Регистрация» или «Войти». Должен открыться главный экран. |
| Поддержка | Меню → «Тех. поддержка» → заполнить форму → «Отправить». Должно появиться сообщение об отправке на сервер (при пустом SUPPORT_SERVER_URL откроется почтовый клиент). |
| Скан помещения | Проект → комната → скан. При пустом SCAN_SERVER_URL используются локальные заглушки; при указанном URL — ответ от сервера (в т.ч. server-single.js отдаёт тестовые dimensions). |
| Подписка | Раздел подписки: при пустом VERIFICATION_SERVER_URL активация идёт только по Google Play на устройстве. |

---

## Сводка: какие URL когда использовать

| Режим | AUTH | SUPPORT | SCAN | VERIFICATION |
|-------|------|---------|------|---------------|
| Эмулятор, локальный сервер | `http://10.0.2.2:3001` | `http://10.0.2.2:3002` | `http://10.0.2.2:3003` | `""` |
| Телефон, локальный ПК | `http://ВАШ_IP:3001` | `http://ВАШ_IP:3002` | `http://ВАШ_IP:3003` | `""` |
| Облако (Render) | один HTTPS-URL | тот же URL | тот же URL | `""` |
| Только демо (без серверов) | `""` | `""` | `""` | `""` |

Файл единого сервера для облака: **`server/server-single.js`**. Локально можно по-прежнему использовать **`server/server.js`** (три порта).

После тестирования можно сменить URL на продакшен-сервера или снова обнулить для локальной разработки.

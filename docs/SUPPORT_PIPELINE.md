# Support Pipeline: очередь, гарантии доставки, статусы

## Текущее состояние

- **Android:** отправка заявки на `POST {SUPPORT_SERVER_URL}/support/tickets` (phone, email, description). При недоступности сервера — fallback на почтовый клиент.
- **Reference server:** приём заявок в память, статус `received`. GET `/support/tickets` — список заявок для проверки.

## Рекомендуемый контракт для production

### 1. Отправка заявки (уже есть)

- **POST** `/support/tickets`  
- Body: `{ "phone", "email", "description" }`  
- Ответ **200:** `{ "id": "<ticket_id>", "status": "received" }`  
- Гарантия доставки: сервер должен персистить заявку (БД) до возврата 200. При сбое — 5xx, клиент переходит на fallback (email).

### 2. Статусы заявки (расширение v1)

Рекомендуемые статусы для бэкенда и будущего отображения в приложении:

| Код | Описание |
|-----|----------|
| `received` | Заявка принята |
| `in_progress` | В работе |
| `waiting_reply` | Ожидается ответ пользователя |
| `resolved` | Закрыта |
| `closed` | Закрыта без решения |

### 3. Опциональные эндпоинты (для расширения)

- **GET** `/support/tickets` — список заявок пользователя (требует авторизации).  
- **GET** `/support/tickets/:id` — детали и история статусов.  
- Ответ может включать `status`, `createdAt`, `updatedAt`, `messages[]`.

Мобильное приложение пока не запрашивает список заявок; при необходимости можно добавить экран «Мои обращения» с вызовом GET и отображением статусов.

## Гарантии доставки

- Сервер должен сохранять заявку в надёжное хранилище до ответа 200.  
- Рекомендуется: очередь (например, RabbitMQ/Kafka) или запись в БД с retry при временных сбоях.  
- Клиент при 5xx/таймауте открывает mail client — дублирование допустимо, сервер должен идемпотентно обрабатывать повторные отправки (по idempotency key или паре email+timestamp).

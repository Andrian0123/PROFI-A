# Суть сканирования помещений в PROFI-A

При сканировании помещение обрабатывается так: запоминаются уже засканированные участки, определяются внутренние углы примыкания, считываются и анализируются параметры помещения **индивидуально по каждой комнате**.

---

## 1. Запомнить участки, которые уже засканированы

**Как это работает:**

- Во время скана сервер строит **покрытие** по облаку точек и (при наличии) траектории камеры.
- В ответе API возвращается:
  - **`coverage.percentage`** — доля площади плана (0–100%), уже покрытая сканном;
  - **`coverage.web_lines`** — линии «паутины» в плоскости пола (уже пройденные участки);
  - **`coverage.missing_zones`** — полигоны **ещё не отсканированных** зон.

Приложение может:

- отображать прогресс (процент и паутину поверх камеры);
- подсвечивать пропуски (`missing_zones`), чтобы пользователь мог добрать недостающие участки.

То есть «запомнить участки, которые уже засканированы» — это использование полей **coverage** и **missing_zones** из ответа сервера и (при необходимости) сохранение последнего состояния покрытия по `scan_id` / `room_id`.

---

## 2. Определить внутренние углы примыкания

**Как это работает:**

- По облаку точек методом RANSAC выделяются плоскости (пол, потолок, стены).
- По пересечениям плоскостей считаются **junctions** — линии примыкания (рёбра), в том числе **внутренние углы**:
  - **`floor_wall_internal`** — пол–стена (внутренний);
  - **`ceiling_wall_internal`** — потолок–стена (внутренний);
  - **`wall_wall_internal`** — внутренний угол двух стен;
  - при наличии проёмов: **`window_opening`**, **`door_opening`** и т.п.

В ответе для каждой junction приходят:

- **`type`** — тип примыкания;
- **`position_3d`** — точка в метрах;
- **`direction`** — направление ребра;
- **`confidence`** — уверенность (0–1).

Таким образом, «определить внутренние углы примыкания» — это использование списка **`junctions`** и отбор по типам `*_internal` и проёмам.

---

## 3. Считывать и анализировать параметры помещения (индивидуально по комнатам)

**Как это работает:**

- Один скан = одна комната (один `scan_id` / одна комната в приложении).
- В ответе в **`dimensions`** возвращаются параметры **именно этой комнаты**:

| Параметр | Поле API | Описание |
|----------|----------|----------|
| Длина | `length_m` | Длина помещения (м), по потолку |
| Ширина | `width_m` | Ширина помещения (м), по потолку |
| Высота | `wall_height_m` | Высота стен (м) |
| Периметр | `perimeter_m` | Периметр (м) |
| Площадь пола | `floor_area_m2` | Площадь пола (м²) |
| Площадь потолка | `ceiling_area_m2` | Площадь потолка (м²) |
| Площадь стен | `wall_area_m2` | Площадь стен (м²) |

Длина и ширина считаются **по верхней части** облака (по потолку), чтобы уменьшить влияние мебели и шума на полу. Площадь потолка равна площади пола при прямоугольной форме; площадь стен = периметр × высота.

Итого: «считывать и анализировать параметры помещения (длина, ширина, площадь потолка, площадь стен, высота) индивидуально по комнатам» — это использование объекта **`dimensions`** из ответа скана и привязка этих значений к конкретной комнате (по `room_id` / записи комнаты в приложении).

---

## 4. Сводка

| Задача | Реализация в системе |
|--------|------------------------|
| Запомнить, какие участки уже засканированы | `coverage.percentage`, `coverage.web_lines`, `coverage.missing_zones` |
| Определить внутренние углы примыкания | Список `junctions` с типами `floor_wall_internal`, `ceiling_wall_internal`, `wall_wall_internal`, проёмы |
| Длина, ширина, высота, площадь потолка, площадь стен — по комнатам | Объект `dimensions`: `length_m`, `width_m`, `wall_height_m`, `ceiling_area_m2`, `wall_area_m2` (и остальные поля) **для каждой комнаты отдельно** (один скан — один набор dimensions) |

Данные приходят в ответах `POST /api/v1/scan/process` и `POST /api/v1/scan/finish`; приложение сохраняет их по `room_id` и при необходимости отображает в форме комнаты (длина, ширина, высота, площади потолка/стен/пола).

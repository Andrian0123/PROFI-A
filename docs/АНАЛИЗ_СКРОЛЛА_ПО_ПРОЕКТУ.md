# Анализ скролла по проекту PROFI-A

Дата: 20.02.2026

---

## 1. Где используется скролл

| Файл | Тип | Примечание |
|------|-----|------------|
| AddRoomScreen.kt | verticalScroll(Column), LazyColumn (проёмы), horizontalScroll(Row шаблонов) | Один общий verticalScroll; внутри — LazyColumn и horizontalScroll |
| ActsScreen.kt | LazyColumn (список актов), verticalScroll в диалоге просмотра акта | Ок |
| CreateProjectScreen.kt | verticalScroll(Column) | Ок |
| NavigationDrawer.kt | verticalScroll(Column) | Ок |
| RoomScanScreen.kt | verticalScroll | Ок |
| SupportScreen, KS3Screen, EditProfileSectionScreen, SettingsScreen | verticalScroll | Ок |
| WorksScreen, AuthScreen, AboutScreen, EditProjectScreen | verticalScroll | Ок |
| ForemanInviteScreen, FormKs2Ks3Screen, CalculatorScreen | verticalScroll | Ок |
| ProfileScreen, MaterialsScreen, SubscriptionScreen, ChangePasswordScreen | verticalScroll | Ок |
| SimpleCalculatorDialog.kt, SelectionDialog.kt | verticalScroll | Ок |
| HomeScreen.kt | LazyColumn(weight(1f)) внутри Column(fillMaxSize) | Ок |
| KS2Screen.kt | Column(fillMaxSize) + LazyColumn(weight(1f)) | Ок |
| SpecialtySelectionScreen.kt | LazyColumn | Нужно проверить родителя |
| ProjectDetailScreen.kt | Column + LazyColumn без weight | **Недочёт** |
| GeneralEstimateScreen.kt | Column + LazyColumn без weight | **Недочёт** |
| StagesScreen.kt | Column + LazyColumn без weight | **Недочёт** |
| RoomTypesScreen.kt | Column + LazyColumn без weight | **Недочёт** |
| WorkCategoryScreen.kt | Column + LazyColumn без weight | **Недочёт** |
| AddWorkTypesScreen.kt | LazyColumn (WorkCategoriesList) | Родитель — Box, список может получать неограниченную высоту / перекрытие с вкладками |
| TwoFaSettingsScreen.kt | Нет скролла | Контент короткий, риск низкий |
| BusinessTypeScreen.kt | Нет скролла | Фиксированный контент, риск низкий |
| SplashScreen.kt | Нет скролла | Минимум контента, риск низкий |

---

## 2. Выявленные недочёты

### 2.1. Критично: LazyColumn без ограничения высоты

В Compose **LazyColumn** должен иметь ограниченную высоту (например, внутри `Column` с `Modifier.fillMaxSize()` и сам с `Modifier.weight(1f)`). Если родитель — просто `Column(Modifier.fillMaxWidth())` без высоты, для LazyColumn приходит неограниченное ограничение по вертикали, что приводит к предупреждениям/ошибкам и к некорректному поведению скролла.

**Затронутые экраны:**

- **ProjectDetailScreen** — корневой `Column` без `fillMaxSize()`, список комнат в `LazyColumn` без `weight(1f)`. При большом числе комнат возможны сбои и отсутствие скролла.
- **GeneralEstimateScreen** — то же: `Column` + `LazyColumn` без `weight(1f)`.
- **StagesScreen** — `Column` + `LazyColumn` без `weight(1f)`.
- **RoomTypesScreen** — `Column` + `LazyColumn` без `weight(1f)`.
- **WorkCategoryScreen** — `Column` + `LazyColumn` без `weight(1f)`.

**Рекомендация:** дать корневому контейнеру контента `Modifier.fillMaxSize()`, а списку — `Modifier.weight(1f)`, по аналогии с KS2Screen и HomeScreen.

**Исправлено 20.02.2026:** во всех пяти экранах добавлены `Column(Modifier.fillMaxSize())` и `LazyColumn(Modifier.weight(1f))`.

---

### 2.2. Вложенный скролл в AddRoomScreen

- Внешний контент: `Column` с `verticalScroll(scrollState)`.
- Внутри: блок проёмов — `LazyColumn` (список проёмов).

При таком сочетании LazyColumn оказывается внутри скроллируемой колонки и теряет ленивую композицию (все элементы измеряются сразу). Для небольшого списка проёмов это допустимо, но с точки зрения архитектуры предпочтительнее один скролл и обычный `Column` с `items` для проёмов. Оставлено как есть с пометкой в отчёте.

---

### 2.3. horizontalScroll в AddRoomScreen

- `Row` с кнопками шаблонов видов работ использует `horizontalScroll(rememberScrollState())` — корректно для горизонтального списка.

---

### 2.4. Экраны без скролла

- **TwoFaSettingsScreen** — один блок (подпись, Switch, подсказка). На малых экранах или при увеличении шрифта теоретически возможен выход за экран; риск низкий.
- **BusinessTypeScreen**, **SplashScreen** — мало контента, скролл не обязателен.

---

### 2.5. AddWorkTypesScreen — структура контента

Контент: `Row` (вкладки) и результат `when(selectedTab)` (Placeholder или `WorkCategoriesList` с LazyColumn) вызываются как несколько корневых дочерних элементов в слоте контента. Фактически они оказываются в одном `Box`, то есть могут накладываться друг на друга. Лучше обернуть в `Column`, чтобы вкладки были сверху, а под ними — контент вкладки с `Modifier.weight(1f)` для списка. Отмечено в отчёте как возможный недочёт структуры.

---

## 3. Итоговая таблица

| Категория | Экраны | Действие |
|-----------|--------|----------|
| LazyColumn без ограничения высоты | ProjectDetailScreen, GeneralEstimateScreen, StagesScreen, RoomTypesScreen, WorkCategoryScreen | Выполнено: добавлены fillMaxSize и weight(1f) |
| Вложенный скролл | AddRoomScreen (verticalScroll + LazyColumn проёмов) | Принять как есть; при росте списка проёмов рассмотреть один verticalScroll + Column |
| Без скролла, контент короткий | TwoFaSettingsScreen, BusinessTypeScreen, SplashScreen | Оставить без изменений или добавить verticalScroll при появлении длинного контента |
| Возможное перекрытие | AddWorkTypesScreen | Проверить разметку: Column + weight(1f) для списка |

После внесения правок в перечисленные экраны скролл по проекту будет вести себя предсказуемо и без предупреждений Compose.

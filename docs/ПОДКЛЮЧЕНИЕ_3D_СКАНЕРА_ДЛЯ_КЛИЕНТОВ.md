# Подключение 3D-сканера помещения для привлечения клиентов

Дата: 21.02.2026

**Да, ресурс 3D-сканера помещения можно подключить уже сейчас.** Ниже — три варианта: от демо у себя до работы у всех клиентов через облако.

---

## Что уже есть в приложении

- **Экран сканирования** — комната → «Фото 3D» → «Сканер помещения»: камера или выбор фото, отправка на сервер, получение размеров (высота, периметр, площадь пола) и подстановка в форму комнаты.
- **Контракт API** — приложение вызывает `POST /api/v1/scan/process` (кадры) и `POST /api/v1/scan/finish` (завершение). URL задаётся через **`SCAN_SERVER_URL`** в `app/build.gradle.kts`.
- В сборке уже указано: `SCAN_SERVER_URL = "http://10.0.2.2:3003"` — для эмулятора при запущенном локальном сервере.

---

## Вариант 1: Демо у себя (для показа клиентам)

**Цель:** показать работающий сценарий «нажал — получил размеры» на своём ПК или в одной сети.

| Шаг | Действие |
|-----|----------|
| 1 | Запустить локальный backend: **`ОТКРЫТЬ_ЛОКАЛЬНЫЙ_СЕРВЕР.bat`** (или `cd server && node server.js`). |
| 2 | **Эмулятор:** в приложении уже стоит `SCAN_SERVER_URL = "http://10.0.2.2:3003"` — ничего не менять. Запустить приложение, открыть проект → комната → «Фото 3D» → «Сканер помещения» → сканировать или выбрать фото. |
| 3 | **Реальное устройство (телефон):** ПК и телефон в одной Wi‑Fi. Узнать IP ПК (`ipconfig`), подставить в `build.gradle.kts`: `SCAN_SERVER_URL = "http://<IP>:3003"`. Добавить этот IP в `app/src/main/res/xml/network_security_config.xml` (см. документацию по проекту). Пересобрать APK и установить на телефон. |

Сервер возвращает **тестовые размеры** (высота 2,7 м, периметр 12 м, площадь 9 м²). Для привлечения клиентов этого достаточно: сценарий «сканировал — размеры подставились» работает.

---

## Вариант 2: Работа у всех клиентов (облако)

**Цель:** раздавать APK или публиковать в магазин так, чтобы 3D-сканер работал у всех пользователей, без вашего запущенного ПК.

| Шаг | Действие |
|-----|----------|
| 1 | Задеплоить **один** backend в облаке (например Render или Railway), используя **`server/server-single.js`** — он обслуживает и Auth, и Support, и Scan на одном порту. |
| 2 | Получить **HTTPS-URL** сервиса (например `https://profia-backend.onrender.com`). |
| 3 | В `app/build.gradle.kts` в `defaultConfig` задать один и тот же URL для всех трёх полей: `AUTH_SERVER_URL`, `SUPPORT_SERVER_URL`, `SCAN_SERVER_URL` (этот же HTTPS-URL). |
| 4 | Собрать release/debug APK и раздавать клиентам или отправить в Google Play. |

Подробные шаги деплоя: **`docs/ПОШАГОВОЕ_ПОДКЛЮЧЕНИЕ_СЕРВИСОВ.md`**, **`docs/БЕСПЛАТНЫЕ_СЕРВИСЫ_ДЛЯ_ТЕСТИРОВАНИЯ.md`**.

Сейчас `server-single.js` отдаёт те же **заглушечные размеры** по `/api/v1/scan/process` и `/api/v1/scan/finish`. Для привлечения клиентов этого достаточно: фича «3D-сканер помещения» работает от начала до конца (фото → размеры в смету).

---

## Вариант 3: Реальная 3D-обработка (позже)

Когда понадобятся **реальные замеры по фото** (ML/компьютерное зрение):

- Развернуть **Python-сервис** (FastAPI/Flask), реализующий тот же контракт: `POST /api/v1/scan/process`, `POST /api/v1/scan/finish` с расчётом размеров по изображениям.
- Хостинг: Render, Railway, Google Cloud Run, Hugging Face Spaces (если используете ML-модели). См. **`docs/КАК_ПОДКЛЮЧИТЬ_СЕРВЕР_СКАНИРОВАНИЯ.md`**, **`docs/БЕСПЛАТНЫЕ_СЕРВИСЫ_ДЛЯ_ТЕСТИРОВАНИЯ.md`** (раздел про скан).
- В приложении **ничего менять не нужно** — только заменить URL на адрес вашего Python-сервиса (или тот же backend, который проксирует запросы на Python).

---

## Как использовать для привлечения клиентов

1. **Включить сценарий** — по варианту 1 или 2 выше, чтобы кнопка «Сканер помещения» давала размеры (даже заглушечные).
2. **Описание в магазине / на сайте** — явно указать: «3D-сканер помещения — автоматическое определение размеров по камере/фото, подстановка в смету». Готовые формулировки: **`docs/ТЕКСТЫ_ДЛЯ_МАГАЗИНА_И_САЙТА.md`**.
3. **Скриншоты** — добавить в карточку приложения экран сканирования и экран с полученными размерами (высота, периметр, площадь).
4. **Видео** — короткий ролик: «Добавил комнату → Сканер помещения → получил размеры → они уже в смете».

---

## Кратко

| Вопрос | Ответ |
|--------|--------|
| Можем ли подключить ресурс 3D-сканера сейчас? | **Да.** Локально — запустить `server.js`; для клиентов — задеплоить `server-single.js` в облако и прописать HTTPS-URL в сборке. |
| Нужны ли правки в коде приложения? | Для вариантов 1–2 **нет** (URL уже настраивается в `build.gradle.kts`). Для варианта 3 — только смена URL на ваш Python-сервис. |
| Достаточно ли заглушки для привлечения клиентов? | Да: пользователь видит работающий поток «сканирование → размеры в смету». Позже можно заменить заглушку на реальную 3D-обработку. |

Контракты API и детали интеграции: **`docs/ИНТЕГРАЦИЯ_СКАНЕРА.md`**, **`docs/BACKEND_API_CONTRACTS.md`**.

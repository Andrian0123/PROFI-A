# Платная версия сканера для всех получателей ссылки

Дата: 21.02.2026

Возможны два понимания. Оба реализуемы на текущем этапе.

---

## Вариант 1: «Платный» сканер = облачный/полноценный сервис для всех по ссылке

**Смысл:** каждый, кто получает ссылку на установку, использует «платную» (полноценную) версию сканера — с вашим облачным сервером обработки.

**Что сделать:**

1. Развернуть backend сканирования в облаке (например `server/server-single.js` на Render/Railway) или подключить платный API обработки.
2. В **`app/build.gradle.kts`** в `defaultConfig` задать один и тот же **HTTPS-URL** для:
   - `AUTH_SERVER_URL`
   - `SUPPORT_SERVER_URL`
   - `SCAN_SERVER_URL`
3. Собрать APK (debug или release) и раздавать его по ссылке (Google Drive, внутренняя раздача и т.п.).

Все, кто установит этот APK по ссылке, будут использовать ваш облачный сканер. Дополнительных проверок подписки в приложении не нужно.

Подробнее: **`docs/ПОДКЛЮЧЕНИЕ_3D_СКАНЕРА_ДЛЯ_КЛИЕНТОВ.md`**, **`docs/ПОШАГОВОЕ_ПОДКЛЮЧЕНИЕ_СЕРВИСОВ.md`**.

---

## Вариант 2: Сканер только по подписке (платная фича для пользователя)

**Смысл:** сканер помещений и сканер документов доступны только при активной подписке (или пробном периоде). Остальные получатели ссылки видят предложение оформить подписку.

**Что уже сделано в коде:**

- Сканер входит в подписку. В **SubscriptionRepository** поток **`hasScannerAccess`**:
  - **До даты активации подписки (01.06.2026)** — доступ у всех, расходы на сканер несём мы.
  - **После этой даты:** значение **`BuildConfig.SCANNER_REQUIRES_SUBSCRIPTION`** задаётся по типу сборки:
    - **Сборка по ссылке (debug)** — `false`: сканер для теста, доступ у всех.
    - **Сборка из магазина (release)** — `true`: только при активной подписке (платный сканер).
- В **AddRoomScreen** при нажатии «Сканер помещения» или «Сканер документов»:
  - если доступа нет — диалог «Фото 3D» закрывается и переход на экран **Подписка**;
  - если доступ есть — открывается экран сканирования.

**Для получателей ссылки (APK не из магазина):**

- Оплата подписки через **Google Play Billing** возможна только если приложение установлено из Google Play (тот же package name). При установке APK по ссылке (например с Google Drive) покупки в приложении могут быть недоступны.
- Варианты:
  - Раздавать по ссылке сборку для **внутреннего/закрытого теста** из Play Console — тогда Billing работает, можно продавать подписку и ограничивать сканер.
  - Либо по ссылке раздавать сборку с **отключённой** проверкой сканера (`SCANNER_REQUIRES_SUBSCRIPTION = false`), а платный сканер включать только в сборках из магазина.

---

## Кратко

| Цель | Действие |
|-----|----------|
| Дать всем по ссылке **облачный/платный (для вас) сканер** | Собрать APK с нужным `SCAN_SERVER_URL` и раздавать по ссылке. Код не меняем. |
| Сделать сканер **платной фичей по подписке** | До даты активации подписки — доступ у всех (расходы на себя). После: в сборке по ссылке (debug) сканер для теста (`SCANNER_REQUIRES_SUBSCRIPTION=false`), в сборке из магазина (release) — платный сканер по подписке (`true`). Задаётся в **app/build.gradle.kts** (defaultConfig и buildTypes.release). |
